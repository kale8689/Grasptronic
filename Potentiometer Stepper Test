#define DIR_PIN 7
#define STEP_PIN 6
#define pot_Pin A0

// Configuration
const int stepsPerRevolution = 100;
const int maxSteps = 1200;        // Maximum steps from center position
const int deadZone = 100;        // Dead zone around center (ADC units)
const int stepDelay = 500;       // Microseconds between steps (speed control)

int currentPos = 0;              // Current motor position
int targetPos = 0;               // Target position from pot

void setup() {
  Serial.begin(9600);
 pinMode(STEP_PIN, OUTPUT);
 pinMode(DIR_PIN, OUTPUT);
digitalWrite(DIR_PIN, HIGH); // Set intial direction to clockwise
}

void loop() {

int position = analogRead(pot_Pin);
// Map pot to position range: -maxSteps to +maxSteps
  // Center position (~2048) = 0 steps
  targetPos = map(position, 0, 4095, -maxSteps, maxSteps);
  
  // Apply dead zone around center
  if (abs(targetPos) < deadZone) {
    targetPos = 0;
  }
  
  // Calculate steps needed
  int stepsToMove = targetPos - currentPos;
  
  // Only move if there's a difference
  if (stepsToMove != 0) {
    // Set direction
    if (stepsToMove > 0) {
      digitalWrite(DIR_PIN, HIGH);  // Clockwise
    } else {
      digitalWrite(DIR_PIN, LOW);   // Counter-clockwise
      stepsToMove = -stepsToMove;   // Make positive for loop
    }
    
    // Move one step toward target
    digitalWrite(STEP_PIN, HIGH);
    delayMicroseconds(stepDelay);
    digitalWrite(STEP_PIN, LOW);
    delayMicroseconds(stepDelay);
    
    // Update current position
    if (targetPos > currentPos) {
      currentPos++;
    } else {
      currentPos--;
    }
    
    // Debug output
    Serial.print("Pot: ");
    Serial.print(position);
    Serial.print(" | Target: ");
    Serial.print(targetPos);
    Serial.print(" | Current: ");
    Serial.println(currentPos);
  }
  
  delay(1);  // Small delay for stability
}
